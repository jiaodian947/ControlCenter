webpackJsonp([3],{Tr1n:function(e,t,a){"use strict";t.c=function(e,t){return Object(l.a)({url:"/api/mail/sendMailList",method:"get",params:{page:e,pageSize:t}})},t.a=function(e){return Object(l.a)({url:"/api/mail/deleteMailLog",method:"get",params:{id:e}})},t.b=function(e){return Object(l.a)({url:"/api/mail/sendMail",method:"post",data:{maildetails:e}})};var l=a("vLgD")},U5xh:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("BO1k"),r=a.n(l),s=a("vMJZ"),n=a("vLgD");var i=a("Tr1n"),o={data:function(){return{form:{send_type:1,mail_roles:"",mail_title:"",mail_type:"",mail_subtype:"",mail_desc:"",attachments:[],send_reason:""},server_selected:"",props:[],servers:[],send_time:""}},created:function(){this.getServersList(this.$store.getters.name),this.getPropsList()},methods:{handleSelected:function(e){this.form.attachments.forEach(function(t){t.name===e.value&&(t.id=e.prop_id)})},getPropsList:function(){var e,t=this;Object(n.a)({url:"/api/props/getPropsList",method:"get",params:e}).then(function(e){var a=!0,l=!1,s=void 0;try{for(var n,i=r()(e.Data.props);!(a=(n=i.next()).done);a=!0){var o=n.value;o.value=o.prop_name}}catch(e){l=!0,s=e}finally{try{!a&&i.return&&i.return()}finally{if(l)throw s}}t.props=e.Data.props})},getServersList:function(e){var t=this;Object(s.d)(e).then(function(e){t.servers=e.Data.servers})},addAttachment:function(){this.form.attachments.push({key:Date.now(),id:"",name:"",count:"",is_bind:!0})},removeAttachment:function(e){var t=this.form.attachments.indexOf(e);-1!==t&&this.form.attachments.splice(t,1)},querySearch:function(e,t){var a=this.props;t(e?a.filter(this.createFilter(e)):a)},createFilter:function(e){return function(t){return 0===t.prop_name.toLowerCase().indexOf(e.toLowerCase())}},sendMail:function(){var e=this;this.send_time=(new Date).getTime();var t={game_id:1,server_id:this.server_selected,send_time:this.send_time,sender:this.$store.getters.name,data:this.form};console.log(t),Object(i.b)(t).then(function(t){console.log(t),200===t.Status?(e.$notify({title:"发送成功",message:"邮件发送成功",type:"success"}),e.$router.push({path:"/mail/list"})):console.log(t)})}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px","label-position":"left"}},[a("el-form-item",{attrs:{label:"发送的区服"}},[a("el-select",{attrs:{placeholder:"please select the server want to send"},model:{value:e.server_selected,callback:function(t){e.server_selected=t},expression:"server_selected"}},e._l(e.servers,function(t){return a("el-option",{key:t.server_ip,attrs:{label:t.server_name,value:t.server_id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.server_name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.server_ip))])])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"发送的类型"}},[a("el-radio-group",{model:{value:e.form.send_type,callback:function(t){e.$set(e.form,"send_type",t)},expression:"form.send_type"}},[a("el-radio",{attrs:{border:"",label:1}},[e._v("全部发送")]),e._v(" "),a("el-radio",{attrs:{border:"",label:2}},[e._v("角色名称")])],1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:2===e.form.send_type,expression:"form.send_type===2"}],attrs:{label:"角色名称"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.mail_roles,callback:function(t){e.$set(e.form,"mail_roles",t)},expression:"form.mail_roles"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮件标题"}},[a("el-input",{model:{value:e.form.mail_title,callback:function(t){e.$set(e.form,"mail_title",t)},expression:"form.mail_title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮件类型"}},[a("el-select",{attrs:{placeholder:"please select mail's type "},model:{value:e.form.mail_type,callback:function(t){e.$set(e.form,"mail_type",t)},expression:"form.mail_type"}},[a("el-option",{attrs:{label:"系统",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"GM",value:"2"}})],1),e._v(" "),a("el-select",{attrs:{placeholder:"please select mail's type "},model:{value:e.form.mail_subtype,callback:function(t){e.$set(e.form,"mail_subtype",t)},expression:"form.mail_subtype"}},[a("el-option",{attrs:{label:"系统",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"GM",value:"2"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"邮件内容"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.mail_desc,callback:function(t){e.$set(e.form,"mail_desc",t)},expression:"form.mail_desc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"增加道具"}},[a("el-button",{on:{click:e.addAttachment}},[e._v("+")])],1),e._v(" "),e._l(e.form.attachments,function(t,l){return a("el-form-item",{key:t.key,attrs:{label:"附件"+(l+1),value:t.id}},[a("el-row",{attrs:{gutter:20,type:"flex"}},[a("el-col",[a("div",{staticClass:"sub-title",attrs:{align:"center"}},[e._v("道具名称")]),e._v(" "),a("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入内容","trigger-on-focus":!0},on:{select:e.handleSelected},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.item;return[a("div",{staticClass:"attachment_name"},[e._v(e._s(l.value))]),e._v(" "),a("span",{staticClass:"attachment_id"},[e._v("id:"+e._s(l.prop_id))])]}}]),model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"attachment.name"}})],1),e._v(" "),a("el-col",[a("div",{staticClass:"sub-title",attrs:{align:"center"}},[e._v("道具数量")]),a("el-input",{model:{value:t.count,callback:function(a){e.$set(t,"count",a)},expression:"attachment.count"}})],1),e._v(" "),a("el-col",[a("br"),a("el-checkbox",{model:{value:t.is_bind,callback:function(a){e.$set(t,"is_bind",a)},expression:"attachment.is_bind"}},[e._v("是否绑定")])],1),e._v(" "),a("el-col",[a("br"),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){a.preventDefault(),e.removeAttachment(t)}}})],1)],1)],1)}),e._v(" "),a("el-form-item",{attrs:{label:"发送原因"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.send_reason,callback:function(t){e.$set(e.form,"send_reason",t)},expression:"form.send_reason"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.sendMail}},[e._v("发送邮件")])],1)],2)],1)},staticRenderFns:[]};var m=a("VU/8")(o,c,!1,function(e){a("aH+5")},null,null);t.default=m.exports},"aH+5":function(e,t){}});
//# sourceMappingURL=3.ff5fb4a6a054ca7829ee.js.map